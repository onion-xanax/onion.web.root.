document.addEventListener('DOMContentLoaded', function () {
    const licenseModal = document.getElementById('licenseModal');
    const registerModal = document.getElementById('registerModal');
    const agreeCheckbox = document.getElementById('agreeCheckbox');
    const acceptButton = document.getElementById('acceptButton');
    const licenseText = document.getElementById('licenseText');
    const googleSignIn = document.getElementById('googleSignIn');

    // Полный текст лицензионного соглашения
    licenseText.innerHTML = `
        <p><strong>Настоящее Лицензионное Соглашение с Конечным Пользователем («Соглашение») представляет собой юридически обязывающий договор между вами («Пользователь», «Вы») и Web Security Research («Правообладатель», «Мы») относительно доступа и использования веб-сайта web.onion.xss, его контента, инструментов, программного обеспечения, данных, аналитики и услуг (совместно именуемые «Сервис»).</strong></p>

        <p><strong>ВНИМАТЕЛЬНО ПРОЧИТАЙТЕ УСЛОВИЯ ДАННОГО СОГЛАШЕНИЯ. ЛЮБОЙ ДОСТУП ИЛИ ИСПОЛЬЗОВАНИЕ СЕРВИСА ПОДТВЕРЖДАЕТ, ЧТО ВЫ ПРОЧЛИ, ПОНЯЛИ И БЕЗОГОВОРОЧНО ПРИНИМАЕТЕ ВСЕ УСЛОВИЯ НАСТОЯЩЕГО СОГЛАШЕНИЯ. ЕСЛИ ВЫ НЕ СОГЛАСНЫ С КАКИМИ-ЛИБО УСЛОВИЯМИ, ВАМ ЗАПРЕЩЕНО ДОСТУПАТЬ К СЕРВИСУ ИЛИ ИСПОЛЬЗОВАТЬ ЕГО.</strong></p>

        <h3>1. ПРЕДМЕТ СОГЛАШЕНИЯ И ПРЕДОСТАВЛЯЕМАЯ ЛИЦЕНЗИЯ</h3>
        <p>1.1. Правообладатель предоставляет Пользователю ограниченную, непередаваемую, непредусматривающую сублицензирование, отзывную, неисключительную лицензию на доступ к Сервису исключительно для вашего личного и внутреннего коммерческого использования в соответствии с условиями настоящего Соглашения.</p>
        <p>1.2. Все материалы, включая, но не ограничиваясь: тексты, статьи, базы данных уязвимостей, программный код, скрипты, алгоритмы, методики, ноу-хау, документацию, графики, интерфейсы, логотипы и товарные знаки, представленные в рамках Сервиса («Контент»), являются объектами интеллектуальной собственности Правообладателя или его лицензиаров и охраняются законодательством об авторском праве, товарных знаках и иными законами.</p>

        <h3>2. ОГРАНИЧЕНИЯ И ЗАПРЕТЫ</h3>
        <p>Пользователю в строгом порядке ЗАПРЕЩАЕТСЯ:</p>
        <ul>
            <li>2.1. Копировать, модифицировать, создавать производные работы, декомпилировать, дизассемблировать, осуществлять обратный инжиниринг или пытаться извлечь исходный код любого программного компонента Сервиса.</li>
            <li>2.2. Перепродавать, лицензировать, сдавать в аренду, передавать, распространять, публично демонстрировать или иным образом коммерчески использовать Сервис или любой его Контент без явного письменного согласия Правообладателя.</li>
            <li>2.3. Использовать Сервис или полученную с его помощью информацию для:
                <ul>
                    <li>Нарушения законов любой юрисдикции, включая, но не ограничиваясь, законы об интеллектуальной собственности, экспортном контроле, защите данных.</li>
                    <li>Проведения несанкционированного тестирования на проникновение, кибератак (DDoS, сканирование уязвимостей без разрешения, взлом), распространения вредоносного ПО или любого иного противоправного действия.</li>
                    <li>Создания инструментов или методик, которые могут быть использованы для нарушения безопасности сетей, систем или данных.</li>
                    <li>Сбора и обработки персональных данных физических лиц без их надлежащего согласия.</li>
                </ul>
            </li>
            <li>2.4. Использовать любые автоматизированные средства (роботы, парсеры, скраперы) для сбора информации с Сервиса без явного письменного разрешения Правообладателя.</li>
            <li>2.5. Предпринимать любые действия, которые могут нарушить работу Сервиса, создать чрезмерную нагрузку на его инфраструктуру или повлиять на его доступность для других пользователей.</li>
        </ul>

        <h3>3. ОТКАЗ ОТ ГАРАНТИЙ</h3>
        <p>СЕРВИС И ВЕСЬ ЕГО КОНТЕНТ ПРЕДОСТАВЛЯЮТСЯ НА УСЛОВИЯХ «КАК ЕСТЬ» И «КАК ДОСТУПНО». ПРАВООБЛАДАТЕЛЬ В ПОЛНОЙ МЕРЕ, РАЗРЕШЕННОЙ ЗАКОНОМ, ОТКАЗЫВАЕТСЯ ОТ ЛЮБЫХ ГАРАНТИЙ, ЯВНЫХ ИЛИ ПОДРАЗУМЕВАЕМЫХ, ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ, ПОДРАЗУМЕВАЕМЫЕ ГАРАНТИИ КОММЕРЧЕСКОЙ ПРИГОДНОСТИ, СООТВЕТСТВИЯ КОНКРЕТНОЙ ЦЕЛИ И НЕНАРУШЕНИЯ ПРАВ. ПРАВООБЛАДАТЕЛЬ НЕ ГАРАНТИРУЕТ, ЧТО:</p>
        <ul>
            <li>СЕРВИС БУДЕТ ФУНКЦИОНИРОВАТЬ БЕСПЕРЕБОЙНО, БЕЗОПАСНО И БЕЗ ОШИБОК;</li>
            <li>РЕЗУЛЬТАТЫ, ПОЛУЧЕННЫЕ С ПОМОЩЬЮ СЕРВИСА, БУДУТ ТОЧНЫМИ, ПОЛНЫМИ И НАДЕЖНЫМИ;</li>
            <li>ИНФОРМАЦИЯ, ПОЛУЧЕННАЯ ИЗ СЕРВИСА, ОБЕСПЕЧИТ ПОЛНУЮ КИБЕРБЕЗОПАСНОСТЬ ВАШИХ СИСТЕМ;</li>
            <li>СЕРВИС БУДЕТ СООТВЕТСТВОВАТЬ ВАШИМ ТРЕБОВАНИЯМ.</li>
        </ul>
        <p>Пользователь признает и соглашается с тем, что использование Сервиса и применение любой полученной информации осуществляется исключительно на его собственный страх и риск.</p>

        <h3>4. ОГРАНИЧЕНИЕ ОТВЕТСТВЕННОСТИ</h3>
        <p>НИ ПРИ КАКИХ ОБСТОЯТЕЛЬСТВАХ ПРАВООБЛАДАТЕЛЬ, ЕГО АФФИЛИРОВАННЫЕ ЛИЦА, ДИРЕКТОРА, СОТРУДНИКИ ИЛИ АГЕНТЫ НЕ НЕСУТ ОТВЕТСТВЕННОСТИ ЗА ЛЮБЫЕ КОСВЕННЫЕ, СЛУЧАЙНЫЕ, СПЕЦИАЛЬНЫЕ, ШТРАФНЫЕ ИЛИ ПОСЛЕДУЮЩИЕ УБЫТКИ, ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ, ПОТЕРЮ ДАННЫХ, ПРИБЫЛИ, ДЕЛОВОЙ РЕПУТАЦИИ ИЛИ ПРЕРЫВАНИЕ БИЗНЕСА, ВОЗНИКШИЕ ВСЛЕДСТВИЕ ИСПОЛЬЗОВАНИЯ ИЛИ НЕВОЗМОЖНОСТИ ИСПОЛЬЗОВАНИЯ СЕРВИСА, ДАЖЕ ЕСЛИ ПРАВООБЛАДАТЕЛЬ БЫЛ ПРЕДУПРЕЖДЕН О ВОЗМОЖНОСТИ ТАКИХ УБЫТКОВ.</p>
        <p>СОВОКУПНАЯ ОТВЕТСТВЕННОСТЬ ПРАВООБЛАДАТЕЛЯ ПЕРЕД ПОЛЬЗОВАТЕЛЕМ ПО ЛЮБОМУ ИСКУ ИЛИ ПРИЧИНЕ НЕ МОЖЕТ ПРЕВЫСИТЬ СУММУ 100 (СТО) ДОЛЛАРОВ США ИЛИ СУММУ, УПЛАЧЕННУЮ ПОЛЬЗОВАТЕЛЕМ ПРАВООБЛАДАТЕЛЮ ЗА ПОСЛЕДНИЕ 12 МЕСЯЦЕВ, В ЗАВИСИМОСТИ ОТ ТОГО, ЧТО БОЛЬШЕ.</p>

        <h3>5. ВОЗМЕЩЕНИЕ УБЫТКОВ</h3>
        <p>Пользователь соглашается защищать, возмещать убытки и оберегать Правообладателя, его аффилированных лиц, руководителей, сотрудников и агентов от любых исков, обязательств, убытков и расходов (включая разумные судебные издержки и гонорары адвокатов), возникающих в связи с или в результате:</p>
        <ul>
            <li>Нарушения Вами настоящего Соглашения;</li>
            <li>Использования Вами Сервиса;</li>
            <li>Нарушения Вами прав любого третьего лица, включая, но не ограничиваясь, нарушениями в области интеллектуальной собственности или защиты данных.</li>
        </ul>

        <h3>6. ЗАКОНОДАТЕЛЬСТВО И ПОДСУДНОСТЬ</h3>
        <p>6.1. Настоящее Соглашение регулируется и толкуется в соответствии с законодательством Российской Федерации, без учета его конфликтных норм.</p>
        <p>6.2. Любой спор, возникающий из настоящего Соглашения или связанный с ним, подлежит исключительной подсудности судов г. Москвы, Российская Федерация.</p>

        <h3>7. ОБЩИЕ ПОЛОЖЕНИЯ</h3>
        <p>7.1. Изменение Соглашения. Правообладатель оставляет за собой право по своему единоличному усмотрению изменять условия настоящего Соглашения в любое время. Изменения вступают в силу с момента их публикации на Сайте. Продолжение использования Сервиса после внесения изменений означает ваше безоговорочное согласие с ними.</p>
        <p>7.2. Прекращение действия. Правообладатель вправе немедленно прекратить или приостановить действие вашей лицензии и доступ к Сервису в случае любого нарушения вами условий настоящего Соглашения.</p>
        <p>7.3. Независимость положений. Если какое-либо положение настоящего Соглашения будет признано недействительным или неисполнимым, остальные положения сохранят свою полную силу.</p>
        <p>7.4. Полнота соглашения. Настоящее Соглашение представляет собой полное и единственное соглашение между Сторонами в отношении его предмета и заменяет собой все предыдущие устные или письменные соглашения и договоренности.</p>

        <p style="text-align: center; margin-top: 20px; font-weight: bold;">Дата последнего обновления: ${new Date().toLocaleDateString('ru-RU')}</p>
    `;

    // Обработчик чекбокса
    agreeCheckbox.addEventListener('change', function () {
        acceptButton.disabled = !this.checked;
    });

    // Обработчик кнопки "Принять"
    acceptButton.addEventListener('click', function () {
        if (agreeCheckbox.checked) {
            // Сохраняем согласие в localStorage
            localStorage.setItem('licenseAccepted', 'true');
            localStorage.setItem('licenseAcceptDate', new Date().toISOString());

            // Показываем окно регистрации, скрываем лицензию
            licenseModal.classList.add('hidden');
            registerModal.classList.remove('hidden');
        }
    });

    // Обработчик входа через Google
    googleSignIn.addEventListener('click', function () {
        // Редирект на серверную аутентификацию Google
        window.location.href = '/auth/google';
    });

    // Проверяем, было ли уже принято соглашение
    if (localStorage.getItem('licenseAccepted') === 'true') {
        licenseModal.classList.add('hidden');
        registerModal.classList.remove('hidden');
    }

    // Предотвращаем закрытие модального окна
    licenseModal.addEventListener('click', function (e) {
        if (e.target === licenseModal) {
            e.preventDefault();
            e.stopPropagation();
        }
    });

    registerModal.addEventListener('click', function (e) {
        if (e.target === registerModal) {
            e.preventDefault();
            e.stopPropagation();
        }
    });
});